{"version":3,"sources":["../src/inplace_editable.js"],"names":["define","$","ajax","templates","notification","str","cfg","url","autocomplete","Pending","removeSpinner","element","removeClass","find","hide","updateValue","mainelement","value","pendingId","attr","join","pendingPromise","addSpinner","call","methodname","args","itemid","component","itemtype","then","data","render","html","js","oldvalue","newelement","replaceNode","focus","trigger","type","ajaxreturn","resolve","fail","ex","e","Event","exception","newvalue","M","util","js_complete","isDefaultPrevented","addClass","spinner","length","show","imageUrl","append","on","keyCode","editingEnabledPromise","stopImmediatePropagation","preventDefault","target","closest","turnEditingOff","el","off","removeAttr","uniqueId","prefix","idlength","uniqid","i","Math","floor","random","turnEditingOnText","get_string","done","s","instr","inputelement","lbl","select","behatsiterunning","val","turnEditingOnToggle","turnEditingOnSelect","options","key","turnEditingOnAutocomplete","attributes","saveelement","cancelelement","multiple","JSON","parse","renderPix","enhance","tags","placeholder","caseSensitive","showSuggestions","noSelectionString","stringify","empty","turnEditingOffEverywhere","each","turnEditingOn","parseJSON","getInplaceEditable","parent","querySelector","getValue","dataset","setValue","getItemId"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     core/inplace_editable\n * @package    core\n * @copyright  2016 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery',\n        'core/ajax',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/config',\n        'core/url',\n        'core/form-autocomplete',\n        'core/pending',\n    ],\n    function($, ajax, templates, notification, str, cfg, url, autocomplete, Pending) {\n\n        const removeSpinner = function(element) {\n            element.removeClass('updating');\n            element.find('img.spinner').hide();\n        };\n\n        const updateValue = function(mainelement, value) {\n            var pendingId = [\n                mainelement.attr('data-itemid'),\n                mainelement.attr('data-component'),\n                mainelement.attr('data-itemtype'),\n            ].join('-');\n            var pendingPromise = new Pending(pendingId);\n\n            addSpinner(mainelement);\n            ajax.call([{\n                methodname: 'core_update_inplace_editable',\n                args: {\n                    itemid: mainelement.attr('data-itemid'),\n                    component: mainelement.attr('data-component'),\n                    itemtype: mainelement.attr('data-itemtype'),\n                    value: value,\n                },\n            }])[0]\n                .then(function(data) {\n                    return templates.render('core/inplace_editable', data)\n                        .then(function(html, js) {\n                            var oldvalue = mainelement.attr('data-value');\n                            var newelement = $(html);\n                            templates.replaceNode(mainelement, newelement, js);\n                            newelement.find('[data-inplaceeditablelink]').focus();\n                            newelement.trigger({\n                                type: 'updated',\n                                ajaxreturn: data,\n                                oldvalue: oldvalue,\n                            });\n\n                            return;\n                        });\n                })\n                .then(function() {\n                    return pendingPromise.resolve();\n                })\n                .fail(function(ex) {\n                    var e = $.Event('updatefailed', {\n                        exception: ex,\n                        newvalue: value\n                    });\n                    removeSpinner(mainelement);\n                    M.util.js_complete(pendingId);\n                    mainelement.trigger(e);\n                    if (!e.isDefaultPrevented()) {\n                        notification.exception(ex);\n                    }\n                });\n        };\n\n        const addSpinner = function(element) {\n            element.addClass('updating');\n            var spinner = element.find('img.spinner');\n            if (spinner.length) {\n                spinner.show();\n            } else {\n                spinner = $('<img/>')\n                    .attr('src', url.imageUrl('i/loading_small'))\n                    .addClass('spinner').addClass('smallicon')\n                    ;\n                element.append(spinner);\n            }\n        };\n\n    $('body').on('click keypress', '[data-inplaceeditable] [data-inplaceeditablelink]', function(e) {\n        if (e.type === 'keypress' && e.keyCode !== 13) {\n            return;\n        }\n        var editingEnabledPromise = new Pending('autocomplete-start-editing');\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        var target = $(this),\n            mainelement = target.closest('[data-inplaceeditable]');\n\n        var turnEditingOff = function(el) {\n            el.find('input').off();\n            el.find('select').off();\n            el.html(el.attr('data-oldcontent'));\n            el.removeAttr('data-oldcontent');\n            el.removeClass('inplaceeditingon');\n            el.find('[data-inplaceeditablelink]').focus();\n        };\n\n        var turnEditingOffEverywhere = function() {\n            $('span.inplaceeditable.inplaceeditingon').each(function() {\n                turnEditingOff($(this));\n            });\n        };\n\n        var uniqueId = function(prefix, idlength) {\n            var uniqid = prefix,\n                i;\n            for (i = 0; i < idlength; i++) {\n                uniqid += String(Math.floor(Math.random() * 10));\n            }\n            // Make sure this ID is not already taken by an existing element.\n            if ($(\"#\" + uniqid).length === 0) {\n                return uniqid;\n            }\n            return uniqueId(prefix, idlength);\n        };\n\n        var turnEditingOnText = function(el) {\n            str.get_string('edittitleinstructions').done(function(s) {\n                var instr = $('<span class=\"editinstructions\">' + s + '</span>').\n                        attr('id', uniqueId('id_editinstructions_', 20)),\n                    inputelement = $('<input type=\"text\"/>').\n                        attr('id', uniqueId('id_inplacevalue_', 20)).\n                        attr('value', el.attr('data-value')).\n                        attr('aria-describedby', instr.attr('id')).\n                        addClass('ignoredirty').\n                        addClass('form-control'),\n                    lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>').\n                        attr('for', inputelement.attr('id'));\n                el.html('').append(instr).append(lbl).append(inputelement);\n\n                inputelement.focus();\n                inputelement.select();\n                inputelement.on('keyup keypress focusout', function(e) {\n                    if (cfg.behatsiterunning && e.type === 'focusout') {\n                        // Behat triggers focusout too often.\n                        return;\n                    }\n                    if (e.type === 'keypress' && e.keyCode === 13) {\n                        // We need 'keypress' event for Enter because keyup/keydown would catch Enter that was\n                        // pressed in other fields.\n                        var val = inputelement.val();\n                        turnEditingOff(el);\n                        updateValue(el, val);\n                    }\n                    if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                        // We need 'keyup' event for Escape because keypress does not work with Escape.\n                        turnEditingOff(el);\n                    }\n                });\n            });\n        };\n\n        var turnEditingOnToggle = function(el, newvalue) {\n            turnEditingOff(el);\n            updateValue(el, newvalue);\n        };\n\n        var turnEditingOnSelect = function(el, options) {\n            var i,\n                inputelement = $('<select></select>').\n                    attr('id', uniqueId('id_inplacevalue_', 20)).\n                    addClass('custom-select'),\n                lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                    .attr('for', inputelement.attr('id'));\n            for (i in options) {\n                inputelement\n                    .append($('<option>')\n                    .attr('value', options[i].key)\n                    .html(options[i].value));\n            }\n            inputelement.val(el.attr('data-value'));\n\n            el.html('')\n                .append(lbl)\n                .append(inputelement);\n\n            inputelement.focus();\n            inputelement.select();\n            inputelement.on('keyup change focusout', function(e) {\n                if (cfg.behatsiterunning && e.type === 'focusout') {\n                    // Behat triggers focusout too often.\n                    return;\n                }\n                if (e.type === 'change') {\n                    var val = inputelement.val();\n                    turnEditingOff(el);\n                    updateValue(el, val);\n                }\n                if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                    // We need 'keyup' event for Escape because keypress does not work with Escape.\n                    turnEditingOff(el);\n                }\n            });\n        };\n\n        var turnEditingOnAutocomplete = function(el, args) {\n            var i,\n                inputelement = $('<select></select>').\n                    attr('id', uniqueId('id_inplacevalue_', 20)).\n                    addClass('form-autocomplete-original-select').\n                    addClass('custom-select'),\n                lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                    .attr('for', inputelement.attr('id')),\n                options = args.options,\n                attributes = args.attributes,\n                saveelement = $('<a href=\"#\"></a>'),\n                cancelelement = $('<a href=\"#\"></a>');\n\n            for (i in options) {\n                inputelement\n                    .append($('<option>')\n                    .attr('value', options[i].key)\n                    .html(options[i].value));\n            }\n            if (attributes.multiple) {\n                inputelement.attr('multiple', 'true');\n            }\n            inputelement.val(JSON.parse(el.attr('data-value')));\n\n            str.get_string('savechanges', 'core').then(function(s) {\n                return templates.renderPix('e/save', 'core', s);\n            }).then(function(html) {\n                saveelement.append(html);\n                return;\n            }).fail(notification.exception);\n\n            str.get_string('cancel', 'core').then(function(s) {\n                return templates.renderPix('e/cancel', 'core', s);\n            }).then(function(html) {\n                cancelelement.append(html);\n                return;\n            }).fail(notification.exception);\n\n            el.html('')\n                .append(lbl)\n                .append(inputelement)\n                .append(saveelement)\n                .append(cancelelement);\n\n            inputelement.focus();\n            inputelement.select();\n            autocomplete.enhance(inputelement,\n                                 attributes.tags,\n                                 attributes.ajax,\n                                 attributes.placeholder,\n                                 attributes.caseSensitive,\n                                 attributes.showSuggestions,\n                                 attributes.noSelectionString)\n                .then(function() {\n                // Focus on the enhanced combobox.\n                el.find('[role=combobox]').focus();\n                // Stop eslint nagging.\n                return;\n            }).fail(notification.exception);\n\n            inputelement.on('keyup', function(e) {\n                if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                    // We need 'keyup' event for Escape because keypress does not work with Escape.\n                    turnEditingOff(el);\n                }\n            });\n            saveelement.on('click', function(e) {\n                var val = JSON.stringify(inputelement.val());\n                // We need to empty the node to destroy all event handlers etc.\n                inputelement.empty();\n                turnEditingOff(el);\n                updateValue(el, val);\n                e.preventDefault();\n            });\n            cancelelement.on('click', function(e) {\n                // We need to empty the node to destroy all event handlers etc.\n                inputelement.empty();\n                turnEditingOff(el);\n                e.preventDefault();\n            });\n        };\n\n        var turnEditingOn = function(el) {\n            el.addClass('inplaceeditingon');\n            el.attr('data-oldcontent', el.html());\n\n            var type = el.attr('data-type');\n            var options = el.attr('data-options');\n\n            if (type === 'toggle') {\n                turnEditingOnToggle(el, options);\n            } else if (type === 'select') {\n                turnEditingOnSelect(el, $.parseJSON(options));\n            } else if (type === 'autocomplete') {\n                turnEditingOnAutocomplete(el, $.parseJSON(options));\n            } else {\n                turnEditingOnText(el);\n            }\n        };\n\n        // Turn editing on for the current element and register handler for Enter/Esc keys.\n        turnEditingOffEverywhere();\n        turnEditingOn(mainelement);\n        editingEnabledPromise.resolve();\n\n    });\n\n\n    return {\n        /**\n         * Return an object to interact with the current inplace editables at a frontend level.\n         *\n         * @param {Element} parent the parent element containing a inplace editable\n         * @returns {Object|undefined} an object to interact with the inplace element, or undefined\n         *                             if no inplace editable is found.\n         */\n        getInplaceEditable: function(parent) {\n            const element = parent.querySelector(`[data-inplaceeditable]`);\n            if (!element) {\n                return undefined;\n            }\n            // Return an object to interact with the inplace editable.\n            return {\n                element,\n                getValue: function() {\n                    return this.element.dataset.value;\n                },\n                setValue: function(newvalue) {\n                    updateValue($(this.element), newvalue);\n                },\n                getItemId: function() {\n                    return this.element.dataset.itemid;\n                },\n            };\n        }\n    };\n});\n"],"file":"inplace_editable.min.js"}