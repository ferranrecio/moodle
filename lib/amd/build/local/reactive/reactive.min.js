define ("core/local/reactive/reactive",["exports","core/log","core/local/reactive/statemanager"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=d(b);c=d(c);function d(a){return a&&a.__esModule?a:{default:a}}function e(a){return i(a)||h(a)||g(a)||f()}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(a,b){if(!a)return;if("string"==typeof a)return j(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return j(a,b)}function h(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function i(a){if(Array.isArray(a))return j(a)}function j(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function k(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function l(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function m(a,b,c){if(b)l(a.prototype,b);if(c)l(a,c);return a}var n=function(){function a(b){var d,e;k(this,a);if(b.eventname===void 0||b.eventdispatch===void 0){throw new Error("Reactivity event required")}this.target=null!==(d=b.target)&&void 0!==d?d:document.createTextNode(null);this.eventname=b.eventname;this.eventdispatch=b.eventdispatch;this.statemanager=new c.default(this.eventdispatch,this.target);this.watchers=new Map([]);this.components=new Set([]);this.mutations=null!==(e=b.mutations)&&void 0!==e?e:{};this.target.addEventListener(this.eventname,this.callWatchersHandler.bind(this));if(b.state!==void 0){this.setInitialState(b.state)}}m(a,[{key:"callWatchersHandler",value:function callWatchersHandler(a){this.target.dispatchEvent(new CustomEvent(a.detail.action,{bubbles:!1,detail:a.detail}))}},{key:"setInitialState",value:function setInitialState(a){this.statemanager.setInitialState(a)}},{key:"addMutations",value:function addMutations(a){for(var b in a){if(a.hasOwnProperty(b)&&"function"==typeof a[b]){this.mutations[b]=a[b].bind(a)}}}},{key:"setMutations",value:function setMutations(a){this.mutations=a}},{key:"getState",value:function getState(){return this.statemanager.state}},{key:"getInitialStatePromise",value:function getInitialStatePromise(){return this.statemanager.getInitialPromise()}},{key:"registerComponent",value:function registerComponent(a){var c,d=this,e=null!==(c=a.name)&&void 0!==c?c:"Unkown component",f=function(){},g=f;if(a.dispatchRegistrationSuccess!==void 0){f=a.dispatchRegistrationSuccess.bind(a)}if(a.dispatchRegistrationFail!==void 0){g=a.dispatchRegistrationFail.bind(a)}if(this.components.has(a)){f();return a}var h=[],i=[];if(a.getWatchers!==void 0){i=a.getWatchers()}i.forEach(function(b){var c=b.watch,f=b.handler;if(c===void 0){g();throw new Error("Missing watch attribute in ".concat(e," watcher"))}if(f===void 0){g();throw new Error("Missing handler for watcher ".concat(c," in ").concat(e))}var i=function(b){f.apply(a,[b.detail])};h.push({target:d.target,watch:c,listener:i});d.target.addEventListener(c,i)});if(a.stateReady!==void 0){this.getInitialStatePromise().then(a.stateReady.bind(a)).catch(function(a){b.default.error("Initial state in ".concat(e," rejected due to: ").concat(a));b.default.error(a)})}this.watchers.set(a,h);this.components.add(a);f();return a}},{key:"unregisterComponent",value:function unregisterComponent(a){if(!this.components.has(a)){return a}this.components.delete(a);var b=this.watchers.get(a);if(b===void 0){return a}b.forEach(function(a){var b=a.target,c=a.watch,d=a.listener;b.removeEventListener(c,d)});this.watchers.delete(a);return a}},{key:"dispatch",value:function dispatch(){for(var a,b,c=arguments.length,d=Array(c),f=0;f<c;f++){d[f]=arguments[f]}a=d[0];b=d.slice(1);if("string"!=typeof a){throw new Error("Dispatch action name must be a string")}if("_"===a.charAt(0)){throw new Error("Illegal Private ".concat(a," mutation method dispatch"))}if(this.mutations[a]===void 0){throw new Error("Unkown ".concat(a," mutation"))}var g=this.mutations[a];g.apply(this.mutations,[this.statemanager].concat(e(b)))}}]);return a}();a.default=n;return a.default});
//# sourceMappingURL=reactive.min.js.map
