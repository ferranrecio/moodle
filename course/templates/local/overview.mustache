{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template core_course/local/overview

    TODO describe template overview

    Example context (json):
    {
        "elements": [
            {
                "name": "Activity 1",
                "shortname": "activity1",
                "icon": "<i class='icon fa fa-graduation-cap'></i>",
                "overviewurl": "https://moodle.org"
            },
            {
                "name": "Activity 2",
                "shortname": "activity2",
                "icon": "<i class='icon fa fa-graduation-cap'></i>",
                "overviewurl": "https://moodle.org"
            }
        ]
    }
}}
<div class="course-overview-content">
    <div id="accordion">
        {{#elements}}
        <div class="card mb-3">
            <div class="card-header border-0" id="heading{{shortname}}" data-mdl-region="overviewsection">
                <h5 class="mb-0">
                    <button
                        class="btn btn-link"
                        data-toggle="collapse"
                        data-target="#collapse{{shortname}}"
                        aria-expanded="false"
                        aria-controls="collapse{{shortname}}"
                    >
                        {{{icon}}} {{{name}}}
                    </button>
                </h5>
            </div>

            <div
                id="collapse{{shortname}}"
                class="collapse"
                aria-labelledby="heading{{shortname}}"
            >
                <div class="card-body">
                    <div class="alert alert-warning" role="alert">
                        <div class="font-weight-bold">
                            This activity hasn't been migrated to the new format yet
                        </div>
                        <div>
                            Indicates that a specific activity is still using the old format and has not yet
                            transitioned to the updated version.
                        </div>
                    </div>
                    <iframe
                        class='w-100 alert alert-secondary alert-block fade in'
                        src='{{{overviewurl}}}'
                        width='560'
                        height='250'
                        frameborder='0'
                        style="min-height: 250px;"
                        allowfullscreen
                    ></iframe>
                </div>
            </div>
        </div>
        {{/elements}}
    </div>
</div>
{{#js}}
function executeCode() {
    const iframes = document.querySelectorAll("iframe");
    iframes.forEach(function(iframe) {
        iframe.onload = function() {
            // Auto scale iframes.
            iframe.style.height = (iframe.contentWindow.document.body.scrollHeight + 30) + 'px';
            // Add base target _parent to the iframes to force iframe links to refresh the page.
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const baseElement = iframeDoc.createElement('base');
            baseElement.target = '_parent';
            iframeDoc.head.appendChild(baseElement);
        };
    });
    document.querySelector('#accordion').addEventListener('click', function(event) {
        const closestSection = event.target.closest('[data-mdl-region="overviewsection"]');
        if (!closestSection) {
            return;
        }
        const button = event.target;
        const targetId = button.getAttribute('data-target');
        const iframe = document.querySelector(targetId + ' iframe');
        if (!iframe) {
            return;
        }
        iframe.style.visibility = 'hidden';
        setTimeout(function() {
            iframe.style.height = (iframe.contentWindow.document.body.scrollHeight + 30) + 'px';
            iframe.style.visibility = 'visible';
        }, 250);
    });
}

if (document.readyState === 'loading') {
    document.addEventListener("DOMContentLoaded", executeCode);
} else {
    executeCode();
}
{{/js}}
