define ("format_editortest/local/tests/reactive",["exports","core_course/local/editor/reactive","format_editortest/local/tests/testbase","core/log"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){f=function(a){return typeof a}}else{f=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return f(a)}function g(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function h(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function i(a,b,c){if(b)h(a.prototype,b);if(c)h(a,c);return a}function j(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)k(a,b)}function k(a,b){k=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return k(a,b)}function l(a){return function(){var b=p(a),c;if(o()){var d=p(this).constructor;c=Reflect.construct(b,arguments,d)}else{c=b.apply(this,arguments)}return m(this,c)}}function m(a,b){if(b&&("object"===f(b)||"function"==typeof b)){return b}return n(a)}function n(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return!0}catch(a){return!1}}function p(a){p=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return p(a)}var q=function(a){j(c,a);var e=l(c);function c(){g(this,c);return e.apply(this,arguments)}i(c,[{key:"init",value:function init(a){this.target=document.getElementById(a);this.eventname="reactive_changed";this.runTests();return!0}},{key:"eventdispatch",value:function eventdispatch(a,b){if(b===void 0){b=document}b.dispatchEvent(new CustomEvent("reactive_changed",{bubbles:!1,detail:a}))}},{key:"testCreation",value:function testCreation(){var a=this,c=this.addTest("Create a new reactive instance"),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,target:this.target,state:{tocheck:{value:"OK"}},mutations:{}});d.registerComponent({stateReady:function stateReady(b){a.assertTrue(c,"OK"===b.tocheck.value)}})}},{key:"testSetInitialState",value:function testSetInitialState(){var a=this,c=this.addTest("Initial state after creationt"),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,target:this.target,mutations:{}});d.registerComponent({stateReady:function stateReady(b){a.assertTrue(c,"OK"===b.tocheck.value)}});d.setInitialState({tocheck:{value:"OK"}})}},{key:"testSetInitialStateWrong",value:function testSetInitialStateWrong(){var a=this.addTest("Exception when setInitial state loaded but it was lready defined"),c=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,target:this.target,state:{tocheck:{value:"OK"}},mutations:{}});try{c.setInitialState({tocheck:{value:"OK"}});this.assertTrue(a,!1)}catch(b){this.assertTrue(a,!0)}}},{key:"testSetInitialStateTwice",value:function testSetInitialStateTwice(){var a=this.addTest("Exception when execture setInitialStgate twice"),c=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,target:this.target,mutations:{}});c.setInitialState({tocheck:{value:"OK"}});try{c.setInitialState({tocheck:{value:"OK"}});this.assertTrue(a,!1)}catch(b){this.assertTrue(a,!0)}}},{key:"testWithoutTarget",value:function testWithoutTarget(){var a=this,c=this.addTest("Instantiate reactive without a DOM target"),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{}});d.registerComponent({stateReady:function stateReady(b){a.assertTrue(c,"OK"===b.tocheck.value)}})}},{key:"testStateReady",value:function testStateReady(){var a=this,c=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,mutations:{}});c.registerComponent({stateReady:function stateReady(b){a.assertTrue(d,"OK"===b.tocheck.value)}});var d=this.addTest("Components stateReady should be called when the state is ready");c.setInitialState({tocheck:{value:"OK"}})}},{key:"testMutations",value:function testMutations(){var a=this,c=this.addTest("Call mutations from a component"),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{passTest:function passTest(b,d,e){var f=b.state;a.assertTrue(c,"OK"===f.tocheck.value&&"Q"===d&&!0===e)}}});d.registerComponent({stateReady:function stateReady(){d.dispatch("passTest","Q",!0)}})}},{key:"testWatchers",value:function testWatchers(){var a=this,c=this.addTest("Test attribute watcher"),d=this.addTest("Test general watcher"),e=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{alter:function alter(a,b){var c=a.state;a.setLocked(!1);c.tocheck.value=b;a.setLocked(!0)}}});e.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck.value:updated",handler:function handler(b){var d=b.element;a.assertTrue(c,"Perfect"===d.value)}},{watch:"tocheck:updated",handler:function handler(b){var c=b.element;a.assertTrue(d,"Perfect"===c.value)}}]},stateReady:function stateReady(){e.dispatch("alter","Perfect")}})}},{key:"testWrongWatchers",value:function testWrongWatchers(){var a=this,c=this.addTest("Watchers has to watch something"),d=this.addTest("Watchers need a handle function"),e=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch});try{e.registerComponent({getWatchers:function getWatchers(){return[{handler:function handler(){a.assertTrue(c,!1)}}]}});this.assertTrue(c,!1)}catch(a){this.assertTrue(c,a!==void 0)}try{e.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck.value:updated"}]}});this.assertTrue(d,!1)}catch(a){this.assertTrue(d,a!==void 0)}}},{key:"testWrongMutation",value:function testWrongMutation(){var a=this,c=this.addTest("Call inexistent mutations from a component"),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}}});d.registerComponent({stateReady:function stateReady(){try{d.dispatch("somemutation","Q",!0);a.assertTrue(c,!1)}catch(b){a.assertTrue(c,!0)}}})}},{key:"testMutationException",value:function testMutationException(){var a=this,c=this.addTest("A mutation throws an exception."),d=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{somemutation:function somemutation(){throw Error("Ups!")}}});d.registerComponent({stateReady:function stateReady(){try{d.dispatch("somemutation","Q",!0);a.assertTrue(c,!1)}catch(b){a.assertTrue(c,!0)}}})}},{key:"testAddMutations",value:function testAddMutations(){var a=this,c=this.addTest("Call an original mutaiton after adding new ones."),d=this.addTest("Call an overridden mutation."),e=this.addTest("Call an added mutation."),f=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{original:function original(){a.assertTrue(c,!0)},modified:function modified(){a.assertTrue(d,!1)}}});f.addMutations({modified:function modified(){a.assertTrue(d,!0)},newmutation:function newmutation(){a.assertTrue(e,!0)}});f.registerComponent({stateReady:function stateReady(){f.dispatch("original");f.dispatch("modified");f.dispatch("newmutation")}})}},{key:"testGetState",value:function testGetState(){var a=this.addTest("Call get state"),c=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch});c.setInitialState({tocheck:{value:"OK"}});var d=c.getState();this.assertTrue(a,"OK"===d.tocheck.value)}},{key:"testWriteStateFromComponent",value:function testWriteStateFromComponent(){var a=this,c=this.addTest("Components cannot write in the state from stateReady."),e=this.addTest("Components cannot write in the state from watchers."),f=this.addTest("Components cannot write in the element from watchers."),g=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"OK"}},mutations:{alter:function alter(a,b){var c=a.state;a.setLocked(!1);c.tocheck.value=b;a.setLocked(!0)}}});g.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck:updated",handler:function handler(b){var c=b.state,g=b.element;try{c.tocheck.value="Nope";a.assertTrue(e,!1)}catch(b){a.assertTrue(e,!0)}try{g.value="Nope";d.default.debug(g);a.assertTrue(f,!1)}catch(b){a.assertTrue(f,!0)}}}]},stateReady:function stateReady(b){try{b.tocheck.value="Nope";a.assertTrue(c,!1)}catch(b){a.assertTrue(c,!0)}g.dispatch("alter","Perfect")}})}},{key:"testEventBubble",value:function testEventBubble(){var a=this,c=this.addTest("General state change triggered."),d=this.addTest("General state change bubbles.",!0),e=this.addTest("Private state watcher event trigger."),f=this.addTest("Private state watcher change does not bubble.",!0),g=new b.default({name:"TestReactive",eventname:this.eventname,eventdispatch:this.eventdispatch,mutations:{alter:function alter(a,b){var c=a.state;a.setLocked(!1);c.tocheck.value=b;a.setLocked(!0)}}});document.addEventListener("tocheck:updated",function(){a.assertTrue(d,!1)});document.addEventListener("tocheck.value:updated",function(){a.assertTrue(f,!1)});g.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck:updated",handler:function handler(){a.assertTrue(c,!0)}},{watch:"tocheck.value:updated",handler:function handler(){a.assertTrue(e,!0)}}]},stateReady:function stateReady(){g.dispatch("alter","Perfect")}});g.setInitialState({tocheck:{value:"OK"}})}},{key:"testSimultaneousReactives",value:function testSimultaneousReactives(){var a=this,c=this.addTest("Reactive instance 1 execute the correct stateReady."),d=this.addTest("Reactive instance 2 execute the correct stateReady."),e=this.addTest("Watcher 1 works with reactive 1 changes."),f=this.addTest("Watcher 2 ignore reactive 1 changes.",!0),g=this.addTest("Watcher 1 ignore reactive 2 changes.",!0),h=this.addTest("Watcher 2 works with reactive 2 changes."),i=new b.default({name:"TestReactive1",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"reactive1"},tocheck2:{value:"reactive1"}},mutations:{alter:function alter(a,b){var c=a.state;a.setLocked(!1);c.tocheck.value=b;a.setLocked(!0)}}}),j=new b.default({name:"TestReactive2",eventname:this.eventname,eventdispatch:this.eventdispatch,state:{tocheck:{value:"reactive2"},tocheck2:{value:"reactive2"}},mutations:{alter:function alter(a,b){var c=a.state;a.setLocked(!1);c.tocheck2.value=b;a.setLocked(!0)}}});i.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck:updated",handler:function handler(b){var c=b.element;a.assertEquals(e,"newreactive1",c.value)}},{watch:"tocheck2:updated",handler:function handler(){a.assertTrue(g,!1)}}]},stateReady:function stateReady(b){a.assertEquals(c,"reactive1",b.tocheck.value);i.dispatch("alter","newreactive1")}});j.registerComponent({getWatchers:function getWatchers(){return[{watch:"tocheck2:updated",handler:function handler(b){var c=b.element;a.assertEquals(h,"newreactive2",c.value)}},{watch:"tocheck:updated",handler:function handler(){a.assertTrue(f,!1)}}]},stateReady:function stateReady(b){a.assertEquals(d,"reactive2",b.tocheck.value);j.dispatch("alter","newreactive2")}})}}]);return c}(c.default),r=new q;a.default=r;return a.default});
//# sourceMappingURL=reactive.min.js.map
