define("core_courseformat/local/courseeditor/uploadmonitor",["exports","core/templates","core/reactive","core_courseformat/selectors"],(function(_exports,_templates,_reactive,_selectors){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * The file upload monitor component.
   *
   * @module     core_courseformat/local/courseeditor/uploadmonitor
   * @class      core_courseformat/local/courseeditor/uploadmonitor
   * @copyright  2022 Ferran Recio <ferran@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_selectors=_interopRequireDefault(_selectors);class Component extends _reactive.BaseComponent{create(){this.name="course_format",this.selectors={ITEM:_selectors.default.content.modals.uploaditem,PROGRESSBAR:_selectors.default.content.modals.progressbar},this.classes={},this.currentItems=new Map}static init(reactive,element,selectors){return element||(element=document.querySelector("[data-queue-monitor]"))||((element=document.createElement("div")).setAttribute("data-queue-monitor","true"),element.classList.add("file-upload-queue-monitor"),document.body.appendChild(element)),new Component({element:element,reactive:reactive,selectors:selectors})}stateReady(state){this._refreshItemsList({state:state})}getWatchers(){return[{watch:"uploading:created",handler:this._refreshItemsList},{watch:"uploading:deleted",handler:this._removeElement},{watch:"uploading.percent:updated",handler:this._updateElement}]}_refreshItemsList(_ref){var _state$uploading;let{state:state}=_ref;const uploading=null!==(_state$uploading=state.uploading)&&void 0!==_state$uploading?_state$uploading:new Map;for(const item of uploading.values())this._createItem(item)}async _createItem(item){if(this.currentItems.has(item.id))return this.currentItems.get(item.id);this.currentItems.set(item.id,document.createElement("div"));const data={id:item.id,filename:item.fileInfo.name,percent:item.fileInfo.percent},{html:html,js:js}=await _templates.default.renderForPromise("core_courseformat/uploadqueue",data);if(this.currentItems.has(item.id)){_templates.default.appendNodeContents(this.element,html,js);const element=this.getElement(this.selectors.ITEM,data.id);return this.currentItems.set(item.id,element),!0}return!1}_updateElement(_ref2){let{element:element}=_ref2;if(!this.currentItems.has(element.id))return;const progress=this.currentItems.get(element.id).querySelector(this.selectors.PROGRESSBAR);progress&&(progress.value=element.percent)}_removeElement(_ref3){let{element:element}=_ref3;if(!this.currentItems.has(element.id))return;const target=this.currentItems.get(element.id);target&&target.parentNode&&target.parentNode.removeChild(target),this.currentItems.delete(element.id)}}return _exports.default=Component,_exports.default}));

//# sourceMappingURL=uploadmonitor.min.js.map