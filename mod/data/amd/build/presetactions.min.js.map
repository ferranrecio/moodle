{"version":3,"file":"presetactions.min.js","sources":["../src/presetactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to manage content bank actions, such as delete or rename.\n *\n * @module     mod_data/presetactions\n * @copyright  2022 Amaia Anabitarte <amaia@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/templates',\n    'core/url',\n    'core/modal_factory',\n    'core/modal_events'],\nfunction($, Ajax, Notification, Str, Templates, Url, ModalFactory, ModalEvents) {\n\n    /**\n     * List of action selectors.\n     *\n     * @type {{DELETE_PRESET: string}}\n     */\n    var ACTIONS = {\n        DELETE_PRESET: '[data-action=\"deletepreset\"]',\n    };\n\n    /**\n     * Actions class.\n     */\n    var Actions = function() {\n        this.registerEvents();\n    };\n\n    /**\n     * Register event listeners.\n     */\n    Actions.prototype.registerEvents = function() {\n        $(ACTIONS.DELETE_PRESET).click(function(e) {\n            e.preventDefault();\n\n            var presetname = $(this).data('presetname');\n            var dataid = $(this).data('dataid');\n            var strings = [\n                {\n                    key: 'deleteconfirm',\n                    component: 'mod_data',\n                    param: {\n                        name: presetname,\n                    }\n                },\n                {\n                    key: 'deletewarning',\n                    component: 'mod_data',\n                },\n                {\n                    key: 'delete',\n                    component: 'core'\n                },\n            ];\n            var deleteButtonText = '';\n            Str.get_strings(strings).then(function(langStrings) {\n                var modalTitle = langStrings[0];\n                var modalBody = langStrings[1];\n                deleteButtonText = langStrings[2];\n\n                return ModalFactory.create({\n                    title: modalTitle,\n                    body: modalBody,\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    large: true\n                });\n            }).done(function(modal) {\n                modal.setSaveButtonText(deleteButtonText);\n                modal.getRoot().on(ModalEvents.save, function() {\n                    // The action is now confirmed, sending an action for it.\n                    return deletePreset(dataid, presetname);\n                });\n\n                // Handle hidden event.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy when hidden.\n                    modal.destroy();\n                });\n\n                // Show the modal.\n                modal.show();\n\n                return;\n            }).catch(Notification.exception);\n        });\n    };\n\n    /**\n     * Delete site user preset.\n     *\n     * @param {int} dataid The id of the current database activity.\n     * @param {string} presetname The preset name to delete.\n     */\n    function deletePreset(dataid, presetname) {\n        var request = {\n            methodname: 'mod_data_delete_saved_preset',\n            args: {\n                dataid: dataid,\n                presetnames: {presetname},\n            }\n        };\n\n        var requestType = 'success';\n        Ajax.call([request])[0].then(function(data) {\n            if (data.result) {\n                return 'presetdeleted';\n            }\n            requestType = 'error';\n            return 'presetnotdeleted';\n\n        }).done(function(message) {\n            var params = {\n                d: dataid\n            };\n            if (requestType == 'success') {\n                params.statusmsg = message;\n            } else {\n                params.errormsg = message;\n            }\n            // Redirect to the main content bank page and display the message as a notification.\n            window.location.href = Url.relativeUrl('mod/data/preset.php', params, false);\n        }).fail(Notification.exception);\n    }\n\n    return /** @alias module:mod_data/presetactions */ {\n        // Public variables and functions.\n\n        /**\n         * Initialise the preset actions.\n         *\n         * @method init\n         * @return {Actions}\n         */\n        'init': function() {\n            return new Actions();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Str","Templates","Url","ModalFactory","ModalEvents","ACTIONS","Actions","registerEvents","prototype","click","e","preventDefault","presetname","this","data","dataid","strings","key","component","param","name","deleteButtonText","get_strings","then","langStrings","modalTitle","modalBody","create","title","body","type","types","SAVE_CANCEL","large","done","modal","setSaveButtonText","getRoot","on","save","request","methodname","args","presetnames","requestType","call","result","message","params","d","statusmsg","errormsg","window","location","href","relativeUrl","fail","exception","deletePreset","hidden","destroy","show","catch"],"mappings":";;;;;;;AAsBAA,gCAAO,CACH,SACA,YACA,oBACA,WACA,iBACA,WACA,qBACA,sBACJ,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,UAAWC,IAAKC,aAAcC,iBAO3DC,sBACe,+BAMfC,QAAU,gBACLC,yBAMTD,QAAQE,UAAUD,eAAiB,WAC/BV,EAAEQ,uBAAuBI,OAAM,SAASC,GACpCA,EAAEC,qBAEEC,WAAaf,EAAEgB,MAAMC,KAAK,cAC1BC,OAASlB,EAAEgB,MAAMC,KAAK,UACtBE,QAAU,CACV,CACIC,IAAK,gBACLC,UAAW,WACXC,MAAO,CACHC,KAAMR,aAGd,CACIK,IAAK,gBACLC,UAAW,YAEf,CACID,IAAK,SACLC,UAAW,SAGfG,iBAAmB,GACvBrB,IAAIsB,YAAYN,SAASO,MAAK,SAASC,iBAC/BC,WAAaD,YAAY,GACzBE,UAAYF,YAAY,UAC5BH,iBAAmBG,YAAY,GAExBrB,aAAawB,OAAO,CACvBC,MAAOH,WACPI,KAAMH,UACNI,KAAM3B,aAAa4B,MAAMC,YACzBC,OAAO,OAEZC,MAAK,SAASC,OACbA,MAAMC,kBAAkBf,kBACxBc,MAAME,UAAUC,GAAGlC,YAAYmC,MAAM,2BAyB3BxB,OAAQH,gBACtB4B,QAAU,CACVC,WAAY,+BACZC,KAAM,CACF3B,OAAQA,OACR4B,YAAa,CAAC/B,WAAAA,cAIlBgC,YAAc,UAClB9C,KAAK+C,KAAK,CAACL,UAAU,GAAGjB,MAAK,SAAST,aAC9BA,KAAKgC,OACE,iBAEXF,YAAc,QACP,uBAERV,MAAK,SAASa,aACTC,OAAS,CACTC,EAAGlC,QAEY,WAAf6B,YACAI,OAAOE,UAAYH,QAEnBC,OAAOG,SAAWJ,QAGtBK,OAAOC,SAASC,KAAOpD,IAAIqD,YAAY,sBAAuBP,QAAQ,MACvEQ,KAAKzD,aAAa0D,WAnDFC,CAAa3C,OAAQH,eAIhCuB,MAAME,UAAUC,GAAGlC,YAAYuD,QAAQ,WAEnCxB,MAAMyB,aAIVzB,MAAM0B,UAGPC,MAAM/D,aAAa0D,eAyCqB,MASvC,kBACG,IAAInD"}