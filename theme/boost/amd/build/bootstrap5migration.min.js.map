{"version":3,"file":"bootstrap5migration.min.js","sources":["../src/bootstrap5migration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Backward compatibility for Bootstrap 5.\n *\n * This module adapts the current page to Bootstrap 5. For now it does it silently as\n * many Moodle templates are still using Bootstrap 4 classes. However, when MDL-XXXXX\n * is integrated, this module will console log a warning message to inform the developer.\n * When the Boostrap 4 backward compatibility period ends in MDL-XXXXX,\n * this module will be removed.\n *\n * @module     theme_boost/bootstrap4migration\n * @copyright  2023 Ferran Recio <ferran@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      4.3\n */\n\nconst replaceBootstrap4Classes = () => {\n    fullClassReplacements();\n    partialClassReplacements();\n};\n\nconst fullClassReplacements = () => {\n    const classReplacements = [\n        {bs4: 'custom-check', bs5: 'form-check'},\n        {bs4: 'custom-switch', bs5: 'form-switch'},\n        {bs4: 'custom-range', bs5: 'form-range'},\n        {bs4: 'custom-control', bs5: 'form-check'},\n        {bs4: 'custom-select', bs5: 'form-select'},\n        {bs4: 'custom-file', bs5: 'form-control'},\n        {bs4: 'badge-primary', bs5: 'bg.primary'},\n        {bs4: 'badge-secondary', bs5: 'bg.secondary'},\n        {bs4: 'badge-success', bs5: 'bg.success'},\n        {bs4: 'badge-danger', bs5: 'bg.danger'},\n        {bs4: 'badge-warning', bs5: 'bg.warning'},\n        {bs4: 'badge-info', bs5: 'bg.info'},\n        {bs4: 'badge-light', bs5: 'bg.light'},\n        {bs4: 'close', bs5: 'btn-close'},\n        {bs4: 'arrow', bs5: 'tooltip-arrow'},\n    ];\n    for (var classReplacement of classReplacements) {\n        const elements = document.querySelectorAll('.' + classReplacement.bs4);\n        for (const element of elements) {\n            window.console.log(`BS5 class replacement`);\n            element.classList.remove(classReplacement.bs4);\n            element.classList.add(classReplacement.bs5);\n        }\n    }\n};\n\nconst partialClassReplacements = () => {\n    const partialClassReplacements = [\n        {bs4: 'left-', bs5: 'start-'},\n        {bs4: 'right-', bs5: 'end-'},\n        {bs4: 'float-left', bs5: 'float-start'},\n        {bs4: 'float-right', bs5: 'float-end'},\n        {bs4: 'text-left', bs5: 'text-start'},\n        {bs4: 'text-right', bs5: 'text-end'},\n        {bs4: 'border-left', bs5: 'border-start'},\n        {bs4: 'border-right', bs5: 'border-end'},\n        {bs4: 'rounded-left', bs5: 'rounded-start'},\n        {bs4: 'rounded-right', bs5: 'rounded-end'},\n        {bs4: 'ml-', bs5: 'ms-'},\n        {bs4: 'mr-', bs5: 'me-'},\n        {bs4: 'pl-', bs5: 'ps-'},\n        {bs4: 'pr-', bs5: 'pe-'},\n    ];\n    for (var partialClassReplacement of partialClassReplacements) {\n        const elements = document.querySelectorAll('[class*=\"' + partialClassReplacement.bs4 + '\"]');\n        for (const element of elements) {\n            window.console.log(`BS5 partial class replacement`);\n            const classes = element.className.split(' ');\n            // eslint-disable-next-line no-loop-func\n            const bs4Classes = classes.filter(cls => cls.includes(partialClassReplacement.bs4));\n            for (const bs4Class of bs4Classes) {\n                const bs5Class = bs4Class.replace(partialClassReplacement.bs4, partialClassReplacement.bs5);\n                element.classList.remove(bs4Class);\n                element.classList.add(bs5Class);\n            }\n        }\n    }\n};\n\nconst replaceBootstrap4Attributes = () => {\n    const attributeReplacements = [\n        {bs4: 'data-toggle', bs5: 'data-bs-toggle'},\n    ];\n    for (var attributeReplacement of attributeReplacements) {\n        const elements = document.querySelectorAll('[' + attributeReplacement.bs4 + ']');\n        for (const element of elements) {\n            element.setAttribute(attributeReplacement.bs5, element.getAttribute(attributeReplacement.bs4));\n            element.removeAttribute(attributeReplacement.bs4);\n        }\n    }\n};\n\nconst constReplaceBootstrap4Structures = () => {\n    replaceMediaObject();\n};\n\nconst replaceMediaObject = () => {\n    // See: https://getbootstrap.com/docs/4.0/layout/media-object/ for more information.\n    const media = document.querySelectorAll('.media');\n    for (const element of media) {\n        window.console.log(`BS4 media fix`);\n        element.classList.remove('media');\n        element.classList.add('d-flex');\n    }\n    const mediaBodies = document.querySelectorAll('.media-body');\n    for (const element of mediaBodies) {\n        element.classList.remove('media-body');\n        element.classList.add('flex-grow-1');\n    }\n};\n\n// All Bootstrap 4 minimal backward compatibility will be removed when MDL-XXXXX is integrated.\nexport const fixBootstrap4BackwardCompatibility = (ignore) => {\n    if (ignore) {\n        return;\n    }\n    replaceBootstrap4Classes();\n    replaceBootstrap4Attributes();\n    constReplaceBootstrap4Structures();\n\n    // TODO: convert cards to grids. Yuhu.\n    // TODO: convert whiteList to allowList.\n    // TODO: convert fallbackPlacements to top, right, bottom, left.\n};\n"],"names":["fullClassReplacements","classReplacements","bs4","bs5","classReplacement","elements","document","querySelectorAll","element","window","console","log","classList","remove","add","partialClassReplacements","partialClassReplacement","bs4Classes","className","split","filter","cls","includes","bs4Class","bs5Class","replace","replaceMediaObject","media","mediaBodies","ignore","attributeReplacements","attributeReplacement","setAttribute","getAttribute","removeAttribute","replaceBootstrap4Attributes"],"mappings":";;;;;;;;;;;;;;;MAmCMA,sBAAwB,WACpBC,kBAAoB,CACtB,CAACC,IAAK,eAAgBC,IAAK,cAC3B,CAACD,IAAK,gBAAiBC,IAAK,eAC5B,CAACD,IAAK,eAAgBC,IAAK,cAC3B,CAACD,IAAK,iBAAkBC,IAAK,cAC7B,CAACD,IAAK,gBAAiBC,IAAK,eAC5B,CAACD,IAAK,cAAeC,IAAK,gBAC1B,CAACD,IAAK,gBAAiBC,IAAK,cAC5B,CAACD,IAAK,kBAAmBC,IAAK,gBAC9B,CAACD,IAAK,gBAAiBC,IAAK,cAC5B,CAACD,IAAK,eAAgBC,IAAK,aAC3B,CAACD,IAAK,gBAAiBC,IAAK,cAC5B,CAACD,IAAK,aAAcC,IAAK,WACzB,CAACD,IAAK,cAAeC,IAAK,YAC1B,CAACD,IAAK,QAASC,IAAK,aACpB,CAACD,IAAK,QAASC,IAAK,sBAEnB,IAAIC,oBAAoBH,kBAAmB,OACtCI,SAAWC,SAASC,iBAAiB,IAAMH,iBAAiBF,SAC7D,MAAMM,WAAWH,SAClBI,OAAOC,QAAQC,6BACfH,QAAQI,UAAUC,OAAOT,iBAAiBF,KAC1CM,QAAQI,UAAUE,IAAIV,iBAAiBD,OAK7CY,yBAA2B,WACvBA,yBAA2B,CAC7B,CAACb,IAAK,QAASC,IAAK,UACpB,CAACD,IAAK,SAAUC,IAAK,QACrB,CAACD,IAAK,aAAcC,IAAK,eACzB,CAACD,IAAK,cAAeC,IAAK,aAC1B,CAACD,IAAK,YAAaC,IAAK,cACxB,CAACD,IAAK,aAAcC,IAAK,YACzB,CAACD,IAAK,cAAeC,IAAK,gBAC1B,CAACD,IAAK,eAAgBC,IAAK,cAC3B,CAACD,IAAK,eAAgBC,IAAK,iBAC3B,CAACD,IAAK,gBAAiBC,IAAK,eAC5B,CAACD,IAAK,MAAOC,IAAK,OAClB,CAACD,IAAK,MAAOC,IAAK,OAClB,CAACD,IAAK,MAAOC,IAAK,OAClB,CAACD,IAAK,MAAOC,IAAK,YAEjB,IAAIa,2BAA2BD,yBAA0B,OACpDV,SAAWC,SAASC,iBAAiB,YAAcS,wBAAwBd,IAAM,UAClF,MAAMM,WAAWH,SAAU,CAC5BI,OAAOC,QAAQC,2CAGTM,WAFUT,QAAQU,UAAUC,MAAM,KAEbC,QAAOC,KAAOA,IAAIC,SAASN,wBAAwBd,WACzE,MAAMqB,YAAYN,WAAY,OACzBO,SAAWD,SAASE,QAAQT,wBAAwBd,IAAKc,wBAAwBb,KACvFK,QAAQI,UAAUC,OAAOU,UACzBf,QAAQI,UAAUE,IAAIU,cAuBhCE,mBAAqB,WAEjBC,MAAQrB,SAASC,iBAAiB,cACnC,MAAMC,WAAWmB,MAClBlB,OAAOC,QAAQC,qBACfH,QAAQI,UAAUC,OAAO,SACzBL,QAAQI,UAAUE,IAAI,gBAEpBc,YAActB,SAASC,iBAAiB,mBACzC,MAAMC,WAAWoB,YAClBpB,QAAQI,UAAUC,OAAO,cACzBL,QAAQI,UAAUE,IAAI,4DAKqBe,SAC3CA,SAnGJ7B,wBACAe,2BAgEgC,YAC1Be,sBAAwB,CAC1B,CAAC5B,IAAK,cAAeC,IAAK,uBAEzB,IAAI4B,wBAAwBD,sBAAuB,OAC9CzB,SAAWC,SAASC,iBAAiB,IAAMwB,qBAAqB7B,IAAM,SACvE,MAAMM,WAAWH,SAClBG,QAAQwB,aAAaD,qBAAqB5B,IAAKK,QAAQyB,aAAaF,qBAAqB7B,MACzFM,QAAQ0B,gBAAgBH,qBAAqB7B,OA8BrDiC,GAxBAT"}